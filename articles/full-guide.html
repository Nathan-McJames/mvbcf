<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Full Guide • mvbcf</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Full Guide">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mvbcf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/full-guide.html">Full Guide</a></li>
    <li><a class="dropdown-item" href="../articles/quick-start.html">Quick-Start Guide</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Full Guide</h1>
            
      

      <div class="d-none name"><code>full-guide.Rmd</code></div>
    </div>

    
    
<p>This guide is intended as a more detailed version of the quick-start
version. Our aim here is to describe the main uses-cases and
functionalities of the mvbcf package, and to provide examples targeted
at some common tasks. We will also cover all of the arguments of the
run_mvbcf() function.</p>
<div class="section level2">
<h2 id="creating-synthetic-data">Creating Synthetic Data<a class="anchor" aria-label="anchor" href="#creating-synthetic-data"></a>
</h2>
<p>Let’s start by creating some synthetic data. In this example we will
imagine we have observational data on school students, and we want to
determine if their participation in optional after-school tutoring
lessons has had an impact on their test scores in mathematics and
English.</p>
<p>Let’s also assume we have data on some important characteristics of
the students such as age, gender, previous test-scores, and the
education level and income of their parents.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">101</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span><span class="op">&lt;-</span><span class="fl">1000</span></span>
<span></span>
<span><span class="va">age</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">11</span>, <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">gender</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span>, <span class="va">n</span>, replace<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">previous_maths_score</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.4</span>, <span class="fl">0.08</span><span class="op">)</span></span>
<span><span class="va">previous_english_score</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0.4</span>, <span class="fl">0.08</span><span class="op">)</span></span>
<span><span class="va">parent_education</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"School"</span>, <span class="st">"Bachelors"</span>, <span class="st">"Masters"</span><span class="op">)</span>, <span class="va">n</span>, </span>
<span>                         replace<span class="op">=</span><span class="cn">T</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">parent_income</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">60000</span>, <span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################</span></span>
<span><span class="co">##Same format for test data##</span></span>
<span><span class="co">#############################</span></span>
<span></span>
<span><span class="va">n_test</span><span class="op">&lt;-</span><span class="fl">1000</span></span>
<span></span>
<span><span class="va">age_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_test</span>, <span class="fl">11</span>, <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">gender_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span>, <span class="va">n_test</span>, replace<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">previous_maths_score_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_test</span>, <span class="fl">0.4</span>, <span class="fl">0.08</span><span class="op">)</span></span>
<span><span class="va">previous_english_score_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_test</span>, <span class="fl">0.4</span>, <span class="fl">0.08</span><span class="op">)</span></span>
<span><span class="va">parent_education_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"School"</span>, <span class="st">"Bachelors"</span>, <span class="st">"Masters"</span><span class="op">)</span>, <span class="va">n_test</span>, </span>
<span>                              replace<span class="op">=</span><span class="cn">T</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">parent_income_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_test</span>, <span class="fl">60000</span>, <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<p>To make the data-generating-process semi-realistic, let’s assume that
students with lower test scores might be more likely to take part in
after school tuition in order to increase their grades.</p>
<p>Let’s also assume that only students from high earning families might
be able to afford extra tuition.</p>
<p>We’ll say that the probability of attending extra lessons is directly
related to their average previous test score, but only students in a
family with an income greater than 70000 can afford it.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">true_propensity</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="op">(</span><span class="va">previous_maths_score</span><span class="op">+</span><span class="va">previous_english_score</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">parent_income</span><span class="op">&gt;</span><span class="fl">70000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">extra_tuition</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="va">true_propensity</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################</span></span>
<span><span class="co">##Same format for test data##</span></span>
<span><span class="co">#############################</span></span>
<span></span>
<span><span class="va">true_propensity_test</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="op">(</span><span class="va">previous_maths_score_test</span><span class="op">+</span><span class="va">previous_english_score_test</span><span class="op">)</span></span>
<span><span class="va">true_propensity_test</span><span class="op">&lt;-</span><span class="va">true_propensity_test</span><span class="op">*</span><span class="op">(</span><span class="va">parent_income_test</span><span class="op">&gt;</span><span class="fl">70000</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">extra_tuition_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_test</span>, <span class="fl">1</span>, <span class="va">true_propensity_test</span><span class="op">)</span></span></code></pre></div>
<p>For the new maths and English scores after a year of taking part/not
taking part in extra tuition, it is reasonable to imagine the
following:</p>
<ul>
<li>The new maths/English score will usually be higher than the previous
score because the students are learning more</li>
<li>Students with highly educated or wealthy parents may have learned
more due to extra educational resources at home</li>
<li>Students who received extra tuition increased their test scores by
more than students who did not</li>
<li>Older students benefit more from extra tuition because of better
developed concentration and study skills</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">new_maths_score</span><span class="op">&lt;-</span><span class="va">previous_maths_score</span><span class="op">+</span></span>
<span>                  <span class="fl">0.05</span><span class="op">+</span></span>
<span>                  <span class="fl">0.05</span><span class="op">*</span><span class="op">(</span><span class="va">parent_education</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bachelors"</span>, <span class="st">"Masters"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="op">(</span><span class="va">parent_income</span><span class="op">/</span><span class="fl">2000000</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="va">extra_tuition</span><span class="op">*</span><span class="fl">0.1</span><span class="op">*</span><span class="op">(</span><span class="va">age</span><span class="op">-</span><span class="fl">11</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Note that this means the treatment effect is given by:</span></span>
<span><span class="va">icate_maths</span><span class="op">&lt;-</span><span class="fl">0.1</span><span class="op">*</span><span class="op">(</span><span class="va">age</span><span class="op">-</span><span class="fl">11</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">new_english_score</span><span class="op">&lt;-</span><span class="va">previous_english_score</span><span class="op">+</span></span>
<span>                  <span class="fl">0.07</span><span class="op">+</span></span>
<span>                  <span class="fl">0.03</span><span class="op">*</span><span class="op">(</span><span class="va">parent_education</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bachelors"</span>, <span class="st">"Masters"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="op">(</span><span class="va">parent_income</span><span class="op">/</span><span class="fl">2500000</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="va">extra_tuition</span><span class="op">*</span><span class="fl">0.12</span><span class="op">*</span><span class="op">(</span><span class="va">age</span><span class="op">-</span><span class="fl">11</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Note that this means the treatment effect is given by:</span></span>
<span><span class="va">icate_english</span><span class="op">&lt;-</span><span class="fl">0.12</span><span class="op">*</span><span class="op">(</span><span class="va">age</span><span class="op">-</span><span class="fl">11</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################</span></span>
<span><span class="co">##Same format for test data##</span></span>
<span><span class="co">#############################</span></span>
<span></span>
<span><span class="va">new_maths_score_test</span><span class="op">&lt;-</span><span class="va">previous_maths_score_test</span><span class="op">+</span></span>
<span>                  <span class="fl">0.05</span><span class="op">+</span></span>
<span>                  <span class="fl">0.05</span><span class="op">*</span><span class="op">(</span><span class="va">parent_education_test</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bachelors"</span>, <span class="st">"Masters"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="op">(</span><span class="va">parent_income_test</span><span class="op">/</span><span class="fl">2000000</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="va">extra_tuition_test</span><span class="op">*</span><span class="fl">0.1</span><span class="op">*</span><span class="op">(</span><span class="va">age_test</span><span class="op">-</span><span class="fl">11</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_test</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Note that this means the treatment effect is given by:</span></span>
<span><span class="va">icate_maths_test</span><span class="op">&lt;-</span><span class="fl">0.1</span><span class="op">*</span><span class="op">(</span><span class="va">age_test</span><span class="op">-</span><span class="fl">11</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">new_english_score_test</span><span class="op">&lt;-</span><span class="va">previous_english_score_test</span><span class="op">+</span></span>
<span>                  <span class="fl">0.07</span><span class="op">+</span></span>
<span>                  <span class="fl">0.03</span><span class="op">*</span><span class="op">(</span><span class="va">parent_education_test</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bachelors"</span>, <span class="st">"Masters"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="op">(</span><span class="va">parent_income_test</span><span class="op">/</span><span class="fl">2500000</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="va">extra_tuition_test</span><span class="op">*</span><span class="fl">0.12</span><span class="op">*</span><span class="op">(</span><span class="va">age_test</span><span class="op">-</span><span class="fl">11</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_test</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Note that this means the treatment effect is given by:</span></span>
<span><span class="va">icate_english_test</span><span class="op">&lt;-</span><span class="fl">0.12</span><span class="op">*</span><span class="op">(</span><span class="va">age_test</span><span class="op">-</span><span class="fl">11</span><span class="op">)</span></span></code></pre></div>
<p>Ok! Our data is ready! Let’s create a dataframe:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">age</span>,</span>
<span>                        <span class="va">gender</span>,</span>
<span>                        <span class="va">previous_maths_score</span>,</span>
<span>                        <span class="va">previous_english_score</span>,</span>
<span>                        <span class="va">parent_education</span>,</span>
<span>                        <span class="va">parent_income</span>,</span>
<span>                        <span class="va">extra_tuition</span>,</span>
<span>                        <span class="va">new_maths_score</span>,</span>
<span>                        <span class="va">new_english_score</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################</span></span>
<span><span class="co">##Same format for test data##</span></span>
<span><span class="co">#############################</span></span>
<span></span>
<span><span class="va">df_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">age_test</span>,</span>
<span>                        <span class="va">gender_test</span>,</span>
<span>                        <span class="va">previous_maths_score_test</span>,</span>
<span>                        <span class="va">previous_english_score_test</span>,</span>
<span>                        <span class="va">parent_education_test</span>,</span>
<span>                        <span class="va">parent_income_test</span>,</span>
<span>                        <span class="va">extra_tuition_test</span>,</span>
<span>                        <span class="va">new_maths_score_test</span>,</span>
<span>                        <span class="va">new_english_score_test</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>At present, the run_mvbcf() function requires the covariates to be
numeric features. Therefore, before proceeding, we need to convert the
factor variables (gender and parent_education) to numeric variables.</p>
<p>Gender does not have a clear ordering, so we will use a simple dummy
variable (0=female, 1=male)</p>
<p>Parent_education does have an ordering to it so we will say
(1=school, 2=bachelors, 3=masters)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">gender</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">gender</span><span class="op">==</span><span class="st">"Female"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">education_map</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"School"</span><span class="op">=</span><span class="fl">1</span>, <span class="st">"Bachelors"</span><span class="op">=</span><span class="fl">2</span>, <span class="st">"Masters"</span><span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">parent_education</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">education_map</span><span class="op">[</span><span class="va">parent_education</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#############################</span></span>
<span><span class="co">##Same format for test data##</span></span>
<span><span class="co">#############################</span></span>
<span></span>
<span><span class="va">df_test</span><span class="op">$</span><span class="va">gender_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df_test</span><span class="op">$</span><span class="va">gender_test</span><span class="op">==</span><span class="st">"Female"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_test</span><span class="op">$</span><span class="va">parent_education_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">education_map</span><span class="op">[</span><span class="va">parent_education_test</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>From here, we can create a matrix of covariates X, an outcome matrix
Y, and a treatment indicator Z.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">age</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">previous_maths_score</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">previous_maths_score</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">previous_english_score</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">previous_english_score</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">parent_income</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">parent_income</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"gender"</span>, <span class="st">"previous_maths_score"</span>, </span>
<span>                   <span class="st">"previous_english_score"</span>, <span class="st">"parent_education"</span>, </span>
<span>                   <span class="st">"parent_income"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">new_maths_score</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">new_maths_score</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">new_english_score</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">new_english_score</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"new_maths_score"</span>, <span class="st">"new_english_score"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">extra_tuition</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">extra_tuition</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Z</span><span class="op">&lt;-</span><span class="va">df</span><span class="op">$</span><span class="va">extra_tuition</span></span>
<span></span>
<span><span class="co">#############################</span></span>
<span><span class="co">##Same format for test data##</span></span>
<span><span class="co">#############################</span></span>
<span></span>
<span><span class="va">df_test</span><span class="op">$</span><span class="va">age_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_test</span><span class="op">$</span><span class="va">age_test</span><span class="op">)</span></span>
<span><span class="va">df_test</span><span class="op">$</span><span class="va">previous_maths_score_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_test</span><span class="op">$</span><span class="va">previous_maths_score_test</span><span class="op">)</span></span>
<span><span class="va">df_test</span><span class="op">$</span><span class="va">previous_english_score_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_test</span><span class="op">$</span><span class="va">previous_english_score_test</span><span class="op">)</span></span>
<span><span class="va">df_test</span><span class="op">$</span><span class="va">parent_income_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_test</span><span class="op">$</span><span class="va">parent_income_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df_test</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_test"</span>, <span class="st">"gender_test"</span>, <span class="st">"previous_maths_score_test"</span>, </span>
<span>                   <span class="st">"previous_english_score_test"</span>, <span class="st">"parent_education_test"</span>, </span>
<span>                   <span class="st">"parent_income_test"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">df_test</span><span class="op">$</span><span class="va">new_maths_score_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_test</span><span class="op">$</span><span class="va">new_maths_score_test</span><span class="op">)</span></span>
<span><span class="va">df_test</span><span class="op">$</span><span class="va">new_english_score_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_test</span><span class="op">$</span><span class="va">new_english_score_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df_test</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"new_maths_score_test"</span>, <span class="st">"new_english_score_test"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_test</span><span class="op">$</span><span class="va">extra_tuition_test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_test</span><span class="op">$</span><span class="va">extra_tuition_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Z_test</span><span class="op">&lt;-</span><span class="va">df_test</span><span class="op">$</span><span class="va">extra_tuition_test</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitting-the-model">Fitting The Model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h2>
<p>With the data prepared, it is time to fit the model to the data.</p>
<p>Only the X_con, y, Z, and X_mod parameters are required because the
other parameters and hyper-parameters have default settings, but here we
will look at them all.</p>
<p>X_con is the matrix of covariates used for creating the decision
rules in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
trees of the model. Here you should include all variables that you wish
to control for as confounding variables. It should have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
rows corresponding to the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
observations, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
columns corresponding to the control variables.</p>
<p>y is the matrix of outcome variables. It should have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
rows and each column should correspond to a unique outcome variable.</p>
<p>Z is the treatment indicator. It should be a vector of length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>,
with a 0 in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">i^{th}</annotation></semantics></math>
position indicating that observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
did not receive treatment. A 1 indicates that observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
did receive treatment.</p>
<p>X_mod is the matrix of covariates used in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
trees of the model. Here you should include the variables that you
believe may be responsible for modifying the effect of treatment.</p>
<p>X_con_test and X_mod_test are the covariate matrices for the control
and moderation variables of the test data.</p>
<p>alpha and beta are the BART tree priors used in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
trees. Defaults are alpha=0.95 and beta=2. Lower alpha values and higher
beta values will lead to greater regularisation in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
trees.</p>
<p>alpha_tau and beta_tau are the BART tree priors used in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
trees. Defaults are alpha_tau=0.25 and beta_tau=3. Lower alpha_tau
values and higher beta_tau values will lead to greater regularisation in
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
trees.</p>
<p>sigma_mu is the prior covariance matrix for the terminal node
parameters in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
trees of the model.</p>
<p>sigma_tau is the prior covariance matrix for the terminal node
parameters in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
trees of the model.</p>
<p>v_0 is the prior degrees of freedom for inverse-wishart
distribution.</p>
<p>sigma_0 is the scale matrix in the prior for inverse-wishart
distribution.</p>
<p>n_iter is the number of MCMC iterations the model will be run for.
The default here is 1000 but this may need to be increased depending on
how quick the model is to converge on your data.</p>
<p>n_tree is the number of trees used in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
part of the model. More trees will allow the model to more flexibly
capture complex patterns such as non-linear relationships or interaction
terms among the confounding variables in X_con.</p>
<p>n_tree_tau is the number of trees used in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
part of the model. More trees will allow the model to more flexibly
capture complex patterns such as non-linear relationships or interaction
terms among the effect moderators in X_mod.</p>
<p>min_nodesize is the least number of observations allowed in a
terminal node. Tree moves resulting in terminal nodes with fewer
observations than this will be automatically rejected.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Load the mvbcf package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nathan-mcjames.github.io/mvbcf/">mvbcf</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">mvbcf_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_mvbcf.html">run_mvbcf</a></span><span class="op">(</span><span class="va">X</span>,</span>
<span>                    <span class="va">y</span>,</span>
<span>                    <span class="va">Z</span>,</span>
<span>                    <span class="va">X</span>,</span>
<span>                    <span class="va">X_test</span>,</span>
<span>                    <span class="va">X_test</span>,</span>
<span>                    alpha <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>                    beta <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    alpha_tau <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>                    beta_tau <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                    sigma_mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">50</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    sigma_tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    v_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">+</span><span class="fl">2</span>,</span>
<span>                    sigma_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    n_iter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                    n_tree <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                    n_tree_tau <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                    min_nodesize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-output---sigmas">Model Output - sigmas<a class="anchor" aria-label="anchor" href="#model-output---sigmas"></a>
</h2>
<p>The sigmas output of the model contains the posterior of the residual
covariance matrix. The dimension of sigmas is
ncol(y)*ncol(y)*n_iter.</p>
<p>To inspect the posterior of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">j^{th}</annotation></semantics></math>
outcome variable,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mrow><mi>j</mi><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\Sigma_{j,j}</annotation></semantics></math>,
or the residual covariance of outcome variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mrow><mi>j</mi><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\Sigma_{j,j}</annotation></semantics></math>,
see the code below.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Look at posterior of residual variance of outcome 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">sigmas</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"l"</span>, </span>
<span>     main<span class="op">=</span><span class="st">"Sigma11 Samples - 1st Outcome Variable"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Samples"</span><span class="op">)</span></span></code></pre></div>
<p><img src="full-guide_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Look at posterior of residual covariance of outcome 1 and outcome 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">sigmas</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="op">]</span>, type<span class="op">=</span><span class="st">"l"</span>, </span>
<span>     main<span class="op">=</span><span class="st">"Sigma12 Samples - Residual Covariance of 1st and 2nd Outcomes"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Samples"</span><span class="op">)</span></span></code></pre></div>
<p><img src="full-guide_files/figure-html/unnamed-chunk-9-2.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="model-output---predictions-and-predictions_test">Model Output - predictions and predictions_test<a class="anchor" aria-label="anchor" href="#model-output---predictions-and-predictions_test"></a>
</h2>
<p>The predictions output of the model contains the posterior of the
individual level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
predictions for each individual. The dimension of predictions is
nrow(y)*ncol(y)*n_iter. The predictions_test output contains the same
output for any test data provided.</p>
<p>To inspect the posterior of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
predictions for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">j^{th}</annotation></semantics></math>
outcome variable associated with individual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
or to obtain the posterior mean of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
predictions for different individuals you can use the following
code.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Look at mu posterior of outcome 2 for individual 23</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span><span class="fl">23</span>,<span class="fl">2</span>,<span class="op">]</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Posterior Samples"</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Posterior of mu Predictions for Specific Individual"</span><span class="op">)</span></span></code></pre></div>
<p><img src="full-guide_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#get posterior mean of mu predictions for all observations</span></span>
<span><span class="va">mu1_preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mu2_preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#If you want to remove some samples as burn-in you can do the following instead</span></span>
<span><span class="va">mu1_preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mu2_preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-output---predictions_tau-and-predictions_tau_test">Model Output - predictions_tau and predictions_tau_test<a class="anchor" aria-label="anchor" href="#model-output---predictions_tau-and-predictions_tau_test"></a>
</h2>
<p>The predictions_tau output of the model contains the posterior of the
individual conditional average treatment effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
predictions for each individual. The dimension of predictions_tau is
nrow(y)*ncol(y)*n_iter. The predictions_tau_test output contains the
same output for any test data provided.</p>
<p>To inspect the posterior of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
predictions for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">j^{th}</annotation></semantics></math>
outcome variable associated with individual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
or to obtain the posterior mean of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
predictions for different individuals you can use the following
code.</p>
<p>Often, you may be interested in the average treatment effect - we
show how to find that as well.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Look at icate posterior of outcome 2 for individual 23</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_tau</span><span class="op">[</span><span class="fl">23</span>,<span class="fl">2</span>,<span class="op">]</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Posterior Samples"</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Posterior of tau Predictions for Specific Individual"</span><span class="op">)</span></span></code></pre></div>
<p><img src="full-guide_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#get posterior mean of tau icate predictions for all observations</span></span>
<span><span class="va">tau1_preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_tau</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tau2_preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_tau</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#If you want to remove some samples as burn-in you can do the following instead</span></span>
<span><span class="va">tau1_preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_tau</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tau2_preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_tau</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#To get the average treatment effect posterior for outcome 1</span></span>
<span><span class="va">ate1_post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_tau</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#To get the average treatment effect posterior for outcome 2</span></span>
<span><span class="va">ate2_post</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_tau</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#Look at density plots of ATE posteriors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">ate1_post</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"ATE Outcome 1"</span>, main<span class="op">=</span><span class="st">"Posterior of ATE for Outcome 1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="full-guide_files/figure-html/unnamed-chunk-11-2.png" width="672"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">ate2_post</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"ATE Outcome 2"</span>, main<span class="op">=</span><span class="st">"Posterior of ATE for Outcome 2"</span><span class="op">)</span></span></code></pre></div>
<p><img src="full-guide_files/figure-html/unnamed-chunk-11-3.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="comparing-predictions-with-ground-truth">Comparing Predictions With Ground Truth<a class="anchor" aria-label="anchor" href="#comparing-predictions-with-ground-truth"></a>
</h2>
<p>Here we provide two examples for checking how well the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
predictions of the unseen test data compare with the ground truth, and
how well the treatment effect predictions of the unseen test data
compare with the ground truth.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">y1_test_preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_test</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">]</span><span class="op">+</span><span class="va">Z_test</span><span class="op">*</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_tau_test</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">y2_test_preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_test</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span><span class="op">+</span><span class="va">Z_test</span><span class="op">*</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_tau_test</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">icate_maths_test_predictions</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_tau_test</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">icate_english_test_predictions</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">mvbcf_mod</span><span class="op">$</span><span class="va">predictions_tau_test</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">new_maths_score_test</span>, <span class="va">y1_test_preds</span>, </span>
<span>     xlab<span class="op">=</span><span class="st">"True Mathematics Score"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Predicted Mathematics Score"</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Predicted vs. True Values"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="full-guide_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">y1_test_residuals</span><span class="op">&lt;-</span><span class="va">new_maths_score_test</span><span class="op">-</span><span class="va">y1_test_preds</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqnorm</a></span><span class="op">(</span><span class="va">y1_test_residuals</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqline</a></span><span class="op">(</span><span class="va">y1_test_residuals</span><span class="op">)</span></span></code></pre></div>
<p><img src="full-guide_files/figure-html/unnamed-chunk-12-2.png" width="672"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">icate_maths_test</span>, <span class="va">icate_maths_test_predictions</span>, </span>
<span>     xlab<span class="op">=</span><span class="st">"True Mathematics Effect"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Predicted Mathematics Effect"</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Predicted vs. True Values"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="full-guide_files/figure-html/unnamed-chunk-12-3.png" width="672"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nathan-McJames.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
